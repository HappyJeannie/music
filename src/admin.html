<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>管理页面</title>
  <style>
    #showPic{
      width: 100px;
      height: 100px;
    }
    img{
      width: 100%;
    }
  </style>
</head>
<body>
  <input type="file" id="selectFile">
  <div id="showPic"></div>
  <button id="upload">开始上传</button>
  <script src="./../node_modules/leancloud-storage/dist/av-min.js"></script>
  <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
  <script>
    // var APP_ID = 'YPvb9cfXnyvVeG54DHsOIscm-gzGzoHsz';
    // var APP_KEY = '4TgQlSLvQtMXkzQcxoC3sLQE';

    // AV.init({
    //   appId: APP_ID,
    //   appKey: APP_KEY
    // });

    // var TestObject = AV.Object.extend('PlayList');
    // var testObject = new TestObject();
    // testObject.save({
    //   cover: 'url',
    //   name:'summer',
    //   desc:'balabalabala',
    //   songs:['1','2']
    // }).then(function(object) {
    //   alert('LeanCloud Rocks!');
    // },
    // ()=>{
    //   alert('err')
    // })
  let urls;
  $('#selectFile').on('change',function(e){
    let file = this.files[0];
    urls = file;
    //创建读取文件的对象
    let reader = new FileReader();
 
    //创建文件读取相关的变量
    let fileurl;
    
    //为文件读取成功设置事件
    reader.onload=function(e) {
        alert('文件读取完成');
        fileurl = e.target.result;
        let html = `<img src=${fileurl}>`
        $("#showPic").append($(html));
    };
 
    //正式读取文件
    reader.readAsDataURL(file);
  })
  $('#upload').on('click',function(){
    let url = $('#showPic img').attr('src');
    let data = new FormData();
    var _files = $('#selectFile')[0].files[0];
    data.append("files",_files);
    console.log(data);
    $.ajax({
      type: 'POST',
      url: 'http://localhost:8888/oss/upload',
      data: data,
      dataType: "json",
      contentType: false,
      processData: false
    }).done(function(res){
      console.log(res);
      alert('success')
      })
  })
  function getObjectURL() {
    var file = document.getElementById('upload').files[0];
 
    //创建读取文件的对象
    var reader = new FileReader();
 
    //创建文件读取相关的变量
    var imgFile;
 
    //为文件读取成功设置事件
    reader.onload=function(e) {
        alert('文件读取完成');
        imgFile = e.target.result;
        console.log(imgFile);
        
        $("#imgContent").attr('src', imgFile);
        return imgFile;
    };
 
    //正式读取文件
    let data = reader.readAsDataURL(file);
   
  }

  </script>
</body>
</html>